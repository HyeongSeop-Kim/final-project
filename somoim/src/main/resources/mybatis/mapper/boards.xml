<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="boardsMapper">
  
   <select id ="selectDatas" resultType="boardsDTO" parameterType="_int">
SELECT B.BOARD_ID AS boardId
,B.BOARD_TITLE AS boardTitle
             ,B.CONTENT AS content
             ,B.BOARD_CREATE_DATE AS boardCreateDate
             ,B."LIKE" AS "like"
             ,B.MOIM_ID AS moimId
             ,B.MEMBER_ID AS memberId
             ,M.MEMBER_NAME AS memberName
             ,S.JOB_NAME AS jobName
FROM (SELECT *
      FROM MOIM_PARTICIPANTS P
      JOIN JOBS J 
      ON J.JOB_ID = P.JOB_ID
      WHERE P.MOIM_ID =  #{id}) S
JOIN BOARDS B 
ON S.MEMBER_ID = B.MEMBER_ID 
JOIN MEMBERS M
ON M.MEMBER_ID = S.MEMBER_ID
WHERE B.MOIM_ID = #{id}
ORDER BY B.BOARD_CREATE_DATE DESC
    </select>

    <select id ="selectWriteDatas" resultType="boardsDTO">
        SELECT B.BOARD_ID AS boardId
             , B.BOARD_TITLE AS boardTitle
             , B.CONTENT AS content
             , B.BOARD_CREATE_DATE AS boardCreateDate
             , B."LIKE" AS "like"
             , B.MOIM_ID AS moimId
             , B.MEMBER_ID AS memberId
             , M.MOIM_TITLE AS moimTitle
          FROM BOARDS B
          JOIN MOIM M
            ON B.MOIM_ID = M.MOIM_ID
         WHERE B.MEMBER_ID = #{id}
    </select>

    <insert id="insertData" parameterType="boardsDTO" >
    INSERT INTO BOARDS VALUES (
                  SQU_BOARDS.NEXTVAL,
                  #{boardTitle}, 
                  #{content},
                  SYSDATE,
                  '',
                  #{moimId},
                  #{memberId})
    </insert>
    
    <delete id="deleteData" parameterType="_int">
        DELETE FROM BOARDS
              WHERE MOIM_ID = #{id}
    </delete>
</mapper>

