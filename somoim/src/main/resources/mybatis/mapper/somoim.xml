<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="moimsMapper">
    <select id="getNextSeq" resultType="_int">
        SELECT SQU_MOIM.NEXTVAL FROM DUAL
    </select>
    <select id="selectAll" resultType="somoimDTO" parameterType="Map">
     
     SELECT RNUM
     	  , moimId, moimTitle, moimInfo
     	  , moimLimit, moimImagePath, categoryId
     	  , locationId, moimCreateDate, locationName 
     	FROM(
	        SELECT ROWNUM AS RNUM
	        	 , M.MOIM_ID AS moimId
	             , M.MOIM_TITLE AS moimTitle
	             , M.MOIM_INFO AS moimInfo
	             , M.MOIM_LIMIT AS moimLimit
	             , M.MOIM_IMAGE_PATH AS moimImagePath
	             , M.CATEGORY_ID AS categoryId
	             , M.LOCATION_ID AS locationId
	             , M.MOIM_CREATE_DATE AS moimCreateDate
	             , L.LOCATION_NAME AS locationName
	        FROM MOIM M
	             LEFT JOIN LOCATIONS L
	             ON M.LOCATION_ID = L.LOCATION_ID
			WHERE 1 = 1
	             <if test=' #{search_title} != "" '>
	              AND M.MOIM_TITLE like '%'||#{search_title}||'%'
	             </if>       	
	       	AND
	       	<![CDATA[ ROWNUM <= #{num_end}]]>       
             )
        WHERE 
        	<![CDATA[RNUM >= #{num_start}]]>    
    </select>
    <select id ="selectAllCnt" resultType="_int">
      SELECT count(*) as cnt
           FROM MOIM M
    </select>
   <select id ="selectData" resultType="somoimDTO">
      SELECT  M.MOIM_ID  AS moimId
             ,M.MOIM_TITLE AS moimTitle
             ,M.MOIM_INFO  AS moimInfo
             ,M.MOIM_LIMIT  AS moimLimit
			 ,L.LOCATION_NAME AS locationName
             ,M.MOIM_IMAGE_PATH  AS moimImagePath
             ,M.LOCATION_ID  AS locationId
           FROM MOIM M
		   JOIN LOCATIONS L
			 ON M.LOCATION_ID = L.LOCATION_ID
          WHERE M.MOIM_ID = #{id}
    </select>
    <insert id="insertData" parameterType="somoimDTO">
        INSERT INTO MOIM(MOIM_ID
                        , MOIM_TITLE
                        , MOIM_INFO
                        , MOIM_LIMIT
                        , LOCATION_ID
                        , MOIM_IMAGE_PATH
                        , CATEGORY_ID
                        , MOIM_CREATE_DATE)
        VALUES(SQU_MOIM.NEXTVAL
              , #{moimTitle}
              , #{moimInfo}
              , #{moimLimit}
              , #{locationId}
              , #{moimImagePath}
              , #{categoryId}
              , SYSDATE)
    </insert>
</mapper>

